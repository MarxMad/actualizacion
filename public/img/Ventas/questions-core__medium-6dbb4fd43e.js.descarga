"use strict";!function(t,e,i,o,s,n){var u=function(t){return this.itemId=t.itemId,this.ui={btnOkModal:e.querySelector(".available-stock-modal-ok-btn"),checkbox:e.querySelector(".available-stock-modal-state")},this.bindEvents(),this};u.prototype.bindEvents=function(){n.on(this.ui.btnOkModal,"click",this.handleOkClick.bind(this))},u.prototype.showModal=function(){this.ui.checkbox.checked=!1},u.prototype.hideModal=function(){this.ui.checkbox.checked=!0},u.prototype.handleOkClick=function(t){t.stopPropagation(),t.preventDefault(),this.hideModal()},u.prototype.sendPreventStockQuestionMelidataTrack=function(t){if(this.itemId){var e={};o("createEventTrack",e),o("withPath","/vip/question/ask/prevent_stock",e),o("withExperiment","vip/preventStockQuestion",t,e),o("withData",{item_id:this.itemId},e),o("sendTrack",e)}},i.PreventStockQuestionModal=u}(window,document,Meli.prototype,window.parent.melidata,window.parent.jQuery,tiny);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e,i,o,s){var n=function(t){if(t=tiny.extend({tr:{}},t),this.tr=t.tr,this.el=e.querySelector('[data-component="question"]'),!this.el)throw new Error("Question: component question does not exist");return this.ui={form:this.el.querySelector("#questions-form"),questionText:this.el.querySelector("#question"),submitButton:this.el.querySelector("#question-btn"),myQuestionsBlock:this.el.querySelector("#questions-own"),myQuestionsTitle:this.el.querySelector("#questions-own > p"),personalQuestionsList:this.el.querySelector("#questions-own ul"),noQuestionsMessage:this.el.querySelector("#questions-empty"),itemId:this.el.querySelector("input[name=itemId]"),showMoreQuestionsButton:this.el.querySelector("#showMoreQuestionsButton")},this.maxLength=this.ui.questionText?this.ui.questionText.getAttribute("maxlength")||2e3:2e3,this.snackbar=null,this.questionGroup=1,this.handlers={checkControls:this.checkControls.bind(this),showQuestionGroup:this.showQuestionGroup.bind(this)},this.init(),this};n.prototype.init=function(){this.bindEvents(),this.ui.questionText&&this.checkControls()},n.prototype.bindEvents=function(){tiny.on(this.ui.form,"submit",this.send.bind(this)),tiny.on(this.ui.questionText,"focus",this.handlers.checkControls),tiny.on(this.ui.questionText,"blur",this.handlers.checkControls),tiny.on(this.ui.questionText,"keyup",this.handlers.checkControls),tiny.on(this.ui.showMoreQuestionsButton,"click",this.handlers.showQuestionGroup),meli.on("question:edit",this.startEditMode.bind(this))},n.prototype.bindModalEvent=function(){meli.iframeModal&&s&&(tiny.off(this.ui.showMoreQuestionsButton,"click",this.handlers.showQuestionGroup),tiny.on(this.ui.showMoreQuestionsButton,"click",function(t){t.preventDefault(),t.stopPropagation(),this.blur(),meli.iframeModal.open(s(this))}))},n.prototype.send=function(t){if(t.preventDefault(),!this.ui.questionText.value.trim())return void this.ui.questionText.focus();var e=this,i=e.ui.form.getAttribute("action");e.ui.submitButton.disabled=!0,tiny.ajax(i,{data:e.serialize(e.ui.form),method:"POST",dataType:"json",context:e,success:e.sendSuccess,error:e.sendError})},n.prototype.serialize=function(t){var e,i,o=[];if("object"==("undefined"==typeof t?"undefined":_typeof(t))&&"FORM"==t.nodeName)for(var s=t.elements.length,n=0;s>n;n++)if(e=t.elements[n],e.name&&!e.disabled&&"file"!=e.type&&"reset"!=e.type&&"submit"!=e.type&&"button"!=e.type)if("select-multiple"==e.type){i=t.elements[n].options.length;for(var u=0;i>u;u++)e.options[u].selected&&(o[o.length]=encodeURIComponent(e.name)+"="+encodeURIComponent(e.options[u].value))}else("checkbox"!=e.type&&"radio"!=e.type||e.checked)&&(o[o.length]=encodeURIComponent(e.name)+"="+encodeURIComponent(e.value));return o.join("&").replace(/%20/g,"+")},n.prototype.sendSuccess=function(e){if(this.ui.submitButton.disabled=!1,"redirect"===e.status)t.location.href=e.url;else if("ok"===e.status){if(e.is_stock_question&&(meli.preventStockQuestionModal.sendPreventStockQuestionMelidataTrack(e.prevent_stock_question_experiment_variant_id),e.should_prevent_stock_question))return meli.preventStockQuestionModal.showModal(),void(this.ui.questionText.value="");e.is_repeated||(meli_ga("send","event","ITEM","QUESTION","VIP"),this.sendMelidataTrack(e,!1)),this.renderPersonalQuestion(),this.renderPersonalQuestionsTitle(),tiny.removeClass(this.ui.myQuestionsBlock,"questions__block--hidden"),this.showFeedbackMessage({type:"ok"}),this.ui.questionText.value="",this.checkControls()}},n.prototype.sendError=function(t){var e=JSON.parse(t.responseText);tiny.removeClass(this.ui.myQuestionsBlock,"questions__block--hidden"),this.showFeedbackMessage({type:"error",message:e.error_message}),this.sendMelidataTrack(t,!0)},n.prototype.sendMelidataTrack=function(t,e){if(this.ui.itemId){var i={item_id:this.ui.itemId.value,context:"/vip",failed:e};e||(i.question_id=t.questionId),o("cleanAndSend","event",{path:"/questions/ask/post",data:i})}},n.prototype.renderPersonalQuestion=function(){var t='<li class="questions__group">\n                          <article class="questions__item questions__item--question">\n                            <div class="questions__icon">\n                              <svg viewBox="0 0 100 100" role="presentation" class="ui-icon ui-icon--question">\n                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ui-icon--question"></use>\n                              </svg>\n                            </div>\n                            <div class="questions__content">\n                              <p>'+this.ui.questionText.value+"</p>\n                            </div>\n                          </article>\n                        </li>";this.ui.personalQuestionsList.insertAdjacentHTML("afterbegin",t)},n.prototype.renderPersonalQuestionsTitle=function(){var t=this.ui.myQuestionsBlock.querySelectorAll(".questions__group");this.ui.myQuestionsTitle.innerHTML=t.length>1?this.tr["Tus preguntas"]:this.tr["Tu pregunta"]},n.prototype.checkControls=function(t){this.ui.personalQuestionsList&&this.ui.personalQuestionsList.querySelectorAll("li").length>0&&this.ui.noQuestionsMessage&&(this.ui.noQuestionsMessage.style.display="none")},n.prototype.showFeedbackMessage=function(t){var e={ok:{type:"success",message:this.tr["¡Listo! Ya enviamos tu pregunta."]},error:{type:"error",message:t.message||this.tr["¡Ups! Hubo un problema al preguntar"]}}[t.type];this.snackbar=new Snackbar({type:e.type,message:e.message})},n.prototype.startEditMode=function(){this.ui.questionText.focus()},n.prototype.showQuestionGroup=function(t){t&&t.preventDefault(),this.questionGroup+=1;var e=this.el.querySelectorAll(".questions__group--"+this.questionGroup),i=this.el.querySelectorAll(".questions__group--"+(this.questionGroup+1));i.length||(this.ui.showMoreQuestionsButton.style.display="none",tiny.removeClass(this.el,"main-section--gradient")),Array.prototype.forEach.call(e,function(t){tiny.removeClass(t,"questions__group--hidden")}),this.ui.showMoreQuestionsButton.blur(),meli.emit("content:change"),4===this.questionGroup&&this.bindModalEvent()},i.Question=n}(window,document,Meli.prototype,window.parent.melidata,window.parent.jQuery);
//# sourceMappingURL=../js/questions-core__medium-6dbb4fd43e.js.map